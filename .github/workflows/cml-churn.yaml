name : churn - imbalanced - dataset
on : [ push ]
permissions : write - all
jobs :
  run :
    runs - on : ubuntu - latest
    steps :
      - uses : actions / checkout@v3
      - uses : actions / setup - node@v3
        with :
          node - version : '16'
      - uses : actions / setup - python@v4
        with :
          python - version : '3.11 '
      - uses : iterative / setup - cml@v1

      - name : Generate Report
        env :
          REPO_TOKEN : $ {{ secrets . GITHUB_TOKEN }}
        run : |

          # Get the report
          echo "## Metrics " > report . md
          # cat metrics . txt >> report . md
          awk 'NR %4{ print " " $0 }{ print ""} ' metrics . txt >> report . md
          echo "## Confusion Matrix " >> report . md
          echo "![](./ conf_matrix . png ) " >> report . md
          cml comment create report . md

        
      - name : Train model & produce metrics
        run : |
          python -m pip install -- upgrade pip
          pip install -r requirements . txt

          # exécuter l' entraînement
          python script . py
          
          # A la fin de script . py on doit avoir , dans le repo du runner :
          # - metrics . txt
          # - conf_matrix . png